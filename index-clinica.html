<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Controle">
  <meta name="theme-color" content="#2E2D29">
  <title>Controle Financeiro</title>
  <style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --primary:#AD7120;
  --primary-dark:#8B5A1B;
  --secondary:#D2A04D;
  --background:#F1F1F1;
  --card-bg:#FFFFFF;
  --header-bg:#2E2D29;
  --success:#4A9B6E;
  --success-light:#E8F5ED;
  --danger:#C45C4D;
  --danger-light:#FEE2E2;
  --warning:#D2A04D;
  --warning-light:#FEF3C7;
  --info:#AD7120;
  --info-light:#FDF4E7;
  --text-dark:#2E2D29;
  --text-medium:#5C5B56;
  --text-light:#8A8985;
  --border:#E0E0E0;
  --safe-top:env(safe-area-inset-top);
  --safe-bottom:env(safe-area-inset-bottom)
}
html,body{height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--background);color:var(--text-dark);font-size:14px}
.setup-screen{position:fixed;inset:0;background:linear-gradient(145deg,#2E2D29,#1a1a17);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10001;padding:20px}.setup-screen.hide{display:none}.setup-logo{font-size:60px;margin-bottom:16px}.setup-title{color:#D2A04D;font-size:24px;font-weight:700}.setup-sub{color:rgba(255,255,255,.7);font-size:14px;margin:8px 0 32px}.setup-box{background:rgba(255,255,255,.08);border-radius:16px;padding:24px;width:100%;max-width:400px;border:1px solid rgba(210,160,77,.3)}.setup-label{color:rgba(255,255,255,.9);font-size:12px;font-weight:600;margin-bottom:8px;display:block}.setup-input{width:100%;padding:14px;border:2px solid rgba(210,160,77,.3);border-radius:10px;font-size:14px;background:rgba(255,255,255,.05);color:#fff;margin-bottom:16px}.setup-input::placeholder{color:rgba(255,255,255,.4)}.setup-input:focus{outline:none;border-color:#D2A04D}.setup-btn{width:100%;padding:16px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;background:linear-gradient(145deg,#D2A04D,#AD7120);color:#fff}.setup-btn:disabled{opacity:.5}.setup-help{color:rgba(255,255,255,.5);font-size:11px;text-align:center;margin-top:12px}.setup-error,.setup-success{padding:12px;border-radius:8px;margin-bottom:16px;font-size:12px;display:none}.setup-error{background:rgba(196,92,77,.2);color:#ff9999}.setup-success{background:rgba(74,155,110,.2);color:#90EE90}.setup-error.show,.setup-success.show{display:block}
.splash{position:fixed;inset:0;background:linear-gradient(145deg,#2E2D29,#1a1a17);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10000;transition:opacity .3s}.splash.hide{opacity:0;pointer-events:none}.splash-logo{font-size:50px;margin-bottom:12px}.splash-title{color:#D2A04D;font-size:22px;font-weight:700}.splash-spin{width:30px;height:30px;border:3px solid rgba(210,160,77,.2);border-top-color:#D2A04D;border-radius:50%;animation:spin .7s linear infinite;margin-top:20px}@keyframes spin{to{transform:rotate(360deg)}}
.app{display:flex;flex-direction:column;height:100vh;padding-top:var(--safe-top)}.app.hide{display:none}
.header{background:var(--header-bg);padding:12px 16px;display:flex;justify-content:space-between;align-items:center}.logo{display:flex;align-items:center;gap:8px;color:#D2A04D;font-size:18px;font-weight:700}.header-right{display:flex;gap:8px}.header-btn{background:rgba(210,160,77,.2);border:1px solid rgba(210,160,77,.3);border-radius:8px;padding:8px 12px;color:#D2A04D;font-size:12px;cursor:pointer;font-weight:500}.header-btn:active{background:rgba(210,160,77,.3)}
.main{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:80px}
.container{padding:12px}
.resumo-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px}
.resumo-card{background:var(--card-bg);border-radius:12px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.06)}.resumo-card.green{border-left:4px solid var(--success)}.resumo-card.red{border-left:4px solid var(--danger)}.resumo-card.gold{border-left:4px solid var(--secondary)}.resumo-card.brown{border-left:4px solid var(--primary)}
.resumo-label{font-size:11px;color:var(--text-light);text-transform:uppercase;font-weight:600;margin-bottom:4px;letter-spacing:.5px}
.resumo-value{font-size:18px;font-weight:700}.resumo-value.green{color:var(--success)}.resumo-value.red{color:var(--danger)}.resumo-value.gold{color:var(--secondary)}.resumo-value.brown{color:var(--primary)}
.section{background:var(--card-bg);border-radius:12px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);overflow:hidden}
.section-header{padding:14px 16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;border-bottom:1px solid var(--border)}
.section-title{font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px;color:var(--text-dark)}
.section-badge{background:linear-gradient(145deg,#D2A04D,#AD7120);color:#fff;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:600}
.section-arrow{font-size:12px;color:var(--text-light);transition:transform .2s}
.section.closed .section-arrow{transform:rotate(-90deg)}
.section.closed .section-body{display:none}
.section-body{padding:12px}
.item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--background);border-radius:10px;margin-bottom:8px;border:1px solid var(--border)}
.item.pago{opacity:.5;background:#f8f8f8}
.item-check{width:20px;height:20px;accent-color:var(--success);cursor:pointer}
.item-info{flex:1;min-width:0}
.item-nome{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text-dark)}
.item.pago .item-nome{text-decoration:line-through;color:var(--text-light)}
.item-detalhe{font-size:11px;color:var(--text-light);margin-top:2px}
.item-valor{font-size:14px;font-weight:700}
.item-valor.green{color:var(--success)}
.item-valor.red{color:var(--danger)}
.item-del{background:none;border:none;font-size:14px;opacity:.3;cursor:pointer;padding:4px}.item-del:hover{opacity:.6}
.item-tipo{font-size:9px;padding:3px 8px;border-radius:6px;font-weight:600;margin-left:6px;text-transform:uppercase}
.item-tipo.pilates{background:#E8F5ED;color:#4A9B6E}
.item-tipo.fisio{background:#FDF4E7;color:#AD7120}
.item-tipo.fixo{background:#E8F5ED;color:#4A9B6E}
.item-tipo.variavel{background:#FEE2E2;color:#C45C4D}
.cartoes-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.cartao-box{background:var(--background);border-radius:10px;padding:12px;text-align:center;position:relative;border:1px solid var(--border)}
.cartao-nome{font-size:11px;font-weight:600;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text-dark)}
.cartao-fat{font-size:13px;color:var(--danger);font-weight:700}
.cartao-disp{font-size:10px;color:var(--success);margin-top:4px}
.cartao-del{position:absolute;top:4px;right:4px;background:var(--danger);color:#fff;border:none;border-radius:50%;width:18px;height:18px;font-size:11px;cursor:pointer;display:none}.cartao-box:hover .cartao-del{display:flex;align-items:center;justify-content:center}
.fin-grid{display:grid;grid-template-columns:1fr;gap:8px}
.fin-box{background:var(--background);border-radius:10px;padding:14px;position:relative;border-left:4px solid var(--secondary);border:1px solid var(--border);border-left:4px solid var(--secondary)}
.fin-nome{font-size:13px;font-weight:600;margin-bottom:6px;color:var(--text-dark)}
.fin-info{display:flex;justify-content:space-between;align-items:center}
.fin-parcela{font-size:11px;color:var(--text-medium)}
.fin-valor{font-size:15px;font-weight:700;color:var(--primary)}
.fin-progress{height:6px;background:var(--border);border-radius:3px;margin-top:8px;overflow:hidden}
.fin-progress-bar{height:100%;background:linear-gradient(90deg,#D2A04D,#AD7120);border-radius:3px}
.fin-del{position:absolute;top:8px;right:8px;background:var(--danger);color:#fff;border:none;border-radius:50%;width:20px;height:20px;font-size:12px;cursor:pointer;display:none}.fin-box:hover .fin-del{display:flex;align-items:center;justify-content:center}
.empty{text-align:center;padding:24px;color:var(--text-light)}
.empty-icon{font-size:32px;margin-bottom:8px;opacity:.4}
.nav{position:fixed;bottom:0;left:0;right:0;background:var(--card-bg);border-top:1px solid var(--border);display:flex;justify-content:space-around;padding:8px 0;padding-bottom:calc(8px + var(--safe-bottom));box-shadow:0 -2px 10px rgba(0,0,0,.05)}
.nav-btn{display:flex;flex-direction:column;align-items:center;gap:3px;border:none;background:none;color:var(--text-light);font-size:10px;font-weight:500;padding:6px 20px;cursor:pointer}
.nav-btn.active{color:var(--primary)}
.nav-btn .ico{font-size:22px}
.tab{display:none}
.tab.active{display:block}
.form-box{background:var(--card-bg);border-radius:12px;padding:18px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
.form-title{font-size:15px;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:var(--text-dark)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.form-group{margin-bottom:12px}
.form-label{display:block;font-size:11px;font-weight:600;color:var(--text-medium);margin-bottom:5px;text-transform:uppercase;letter-spacing:.3px}
.form-input,.form-select{width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:14px;background:var(--card-bg);color:var(--text-dark)}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(173,113,32,.1)}
.btn{width:100%;padding:14px;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;background:linear-gradient(145deg,#D2A04D,#AD7120);color:#fff;box-shadow:0 2px 8px rgba(173,113,32,.3)}
.btn:disabled{opacity:.5}
.btn:active{transform:scale(.98)}
.btn-secondary{background:var(--background);color:var(--text-dark);box-shadow:none;border:1px solid var(--border)}
.btn-danger{background:linear-gradient(145deg,#ef5350,#c62828)}
.btn-sm{padding:10px 16px;font-size:12px;width:auto}
.toast-wrap{position:fixed;top:70px;left:12px;right:12px;z-index:9000;pointer-events:none}
.toast{background:var(--header-bg);color:#fff;padding:14px 18px;border-radius:10px;margin-bottom:8px;font-size:13px;font-weight:500;animation:fadeIn .3s;box-shadow:0 4px 12px rgba(0,0,0,.15)}
.toast.ok{background:var(--success)}
.toast.err{background:var(--danger)}
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
  </style>
</head>
<body>
  <div class="setup-screen" id="setupScreen"><div class="setup-logo">üíº</div><div class="setup-title">Controle Financeiro</div><div class="setup-sub">Configure sua conex√£o</div><div class="setup-box"><div class="setup-error" id="setupError"></div><div class="setup-success" id="setupSuccess"></div><label class="setup-label">URL da API</label><input type="text" class="setup-input" id="setupApiUrl" placeholder="https://script.google.com/macros/s/..."><button class="setup-btn" onclick="testarConexao()">Conectar</button><p class="setup-help">N√£o tem a URL? Pe√ßa ao administrador.</p></div></div>
  <div class="splash hide" id="splash"><div class="splash-logo">üíº</div><div class="splash-title">Carregando...</div><div class="splash-spin"></div></div>
  <div class="app hide" id="appMain">
    <header class="header"><div class="logo"><span>üíº</span><span>Controle</span></div><div class="header-right"><button class="header-btn" onclick="resetarMes()">üîÑ Novo M√™s</button><button class="header-btn" onclick="abrirConfig()">‚öôÔ∏è</button></div></header>
    <div class="toast-wrap" id="toastWrap"></div>
    <main class="main">
      <section class="tab active" id="tab-home"><div class="container">
        <div class="resumo-grid">
          <div class="resumo-card green"><div class="resumo-label">Entradas</div><div class="resumo-value green" id="vEntradas">R$ 0</div></div>
          <div class="resumo-card red"><div class="resumo-label">Sa√≠das</div><div class="resumo-value red" id="vSaidas">R$ 0</div></div>
          <div class="resumo-card gold"><div class="resumo-label">A Receber</div><div class="resumo-value gold" id="vAReceber">R$ 0</div></div>
          <div class="resumo-card brown"><div class="resumo-label">A Pagar</div><div class="resumo-value brown" id="vAPagar">R$ 0</div></div>
        </div>
        <div class="section" id="secClientes"><div class="section-header" onclick="toggleSection('secClientes')"><div class="section-title">üí™ Clientes <span class="section-badge" id="badgeClientes">0</span></div><span class="section-arrow">‚ñº</span></div><div class="section-body" id="listaClientes"></div></div>
        <div class="section" id="secContas"><div class="section-header" onclick="toggleSection('secContas')"><div class="section-title">üìã Contas Fixas <span class="section-badge" id="badgeContas">0</span></div><span class="section-arrow">‚ñº</span></div><div class="section-body" id="listaContas"></div></div>
        <div class="section" id="secGatos"><div class="section-header" onclick="toggleSection('secGatos')"><div class="section-title">üê± Gatos <span class="section-badge" id="badgeGatos">0</span></div><span class="section-arrow">‚ñº</span></div><div class="section-body" id="listaGatos"></div></div>
        <div class="section" id="secCartoes"><div class="section-header" onclick="toggleSection('secCartoes')"><div class="section-title">üí≥ Cart√µes</div><span class="section-arrow">‚ñº</span></div><div class="section-body"><div class="cartoes-grid" id="listaCartoes"></div></div></div>
        <div class="section" id="secFin"><div class="section-header" onclick="toggleSection('secFin')"><div class="section-title">üè¶ Financiamentos</div><span class="section-arrow">‚ñº</span></div><div class="section-body"><div class="fin-grid" id="listaFin"></div></div></div>
      </div></section>
      <section class="tab" id="tab-add"><div class="container">
        <div class="form-box"><div class="form-title">üí™ Novo Cliente</div><form onsubmit="salvarCliente(event)"><div class="form-row"><div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="cliNome" required></div><div class="form-group"><label class="form-label">Tipo</label><select class="form-select" id="cliTipo"><option value="Pilates">Pilates</option><option value="Fisioterapia">Fisioterapia</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Dia Pagamento</label><input type="number" class="form-input" id="cliDia" min="1" max="31" value="1" required></div><div class="form-group"><label class="form-label">Valor</label><input type="number" class="form-input" id="cliValor" step="0.01" required></div></div><button type="submit" class="btn">Adicionar Cliente</button></form></div>
        <div class="form-box"><div class="form-title">üìã Nova Conta Fixa</div><form onsubmit="salvarConta(event)"><div class="form-row"><div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="contaNome" required></div><div class="form-group"><label class="form-label">Dia</label><input type="number" class="form-input" id="contaDia" min="1" max="31" required></div></div><div class="form-group"><label class="form-label">Valor</label><input type="number" class="form-input" id="contaValor" step="0.01" required></div><button type="submit" class="btn">Adicionar Conta</button></form></div>
        <div class="form-box"><div class="form-title">üê± Despesa Gatos</div><form onsubmit="salvarGato(event)"><div class="form-row"><div class="form-group"><label class="form-label">Descri√ß√£o</label><input type="text" class="form-input" id="gatoNome" required></div><div class="form-group"><label class="form-label">Tipo</label><select class="form-select" id="gatoTipo"><option value="Fixo">Fixo (mensal)</option><option value="Vari√°vel">Vari√°vel (√∫nico)</option></select></div></div><div class="form-group"><label class="form-label">Valor</label><input type="number" class="form-input" id="gatoValor" step="0.01" required></div><button type="submit" class="btn">Adicionar</button></form></div>
        <div class="form-box"><div class="form-title">üí≥ Novo Cart√£o</div><form onsubmit="salvarCartao(event)"><div class="form-row"><div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="cartNome" required></div><div class="form-group"><label class="form-label">Limite</label><input type="number" class="form-input" id="cartLimite" step="0.01" required></div></div><div class="form-row"><div class="form-group"><label class="form-label">Fechamento</label><input type="number" class="form-input" id="cartFech" min="1" max="31" value="1"></div><div class="form-group"><label class="form-label">Vencimento</label><input type="number" class="form-input" id="cartVenc" min="1" max="31" value="10"></div></div><button type="submit" class="btn">Adicionar Cart√£o</button></form></div>
        <div class="form-box"><div class="form-title">üè¶ Novo Financiamento</div><form onsubmit="salvarFin(event)"><div class="form-row"><div class="form-group"><label class="form-label">Nome</label><input type="text" class="form-input" id="finNome" required></div><div class="form-group"><label class="form-label">Valor Total</label><input type="number" class="form-input" id="finTotal" step="0.01" required></div></div><div class="form-row"><div class="form-group"><label class="form-label">Parcelas</label><input type="number" class="form-input" id="finParcelas" min="1" required></div><div class="form-group"><label class="form-label">Parcela Atual</label><input type="number" class="form-input" id="finAtual" min="1" value="1"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Valor Parcela</label><input type="number" class="form-input" id="finValor" step="0.01" required></div><div class="form-group"><label class="form-label">Dia Venc.</label><input type="number" class="form-input" id="finDia" min="1" max="31" required></div></div><button type="submit" class="btn">Adicionar</button></form></div>
      </div></section>
    </main>
    <nav class="nav"><button class="nav-btn active" onclick="switchTab('tab-home')"><span class="ico">üìä</span><span>Resumo</span></button><button class="nav-btn" onclick="switchTab('tab-add')"><span class="ico">‚ûï</span><span>Adicionar</span></button></nav>
  </div>
<script>
var API_URL='',data={clientes:[],contasFixas:[],gatos:[],cartoes:[],financiamentos:[],historico:[],resumo:{}};

function checkConfig(){var p=new URLSearchParams(window.location.search),a=p.get('api');if(a){API_URL=a;localStorage.setItem('clinica_api_url',a);iniciarApp();return}var s=localStorage.getItem('clinica_api_url');if(s){API_URL=s;iniciarApp();return}document.getElementById('setupScreen').classList.remove('hide')}
async function testarConexao(){var u=document.getElementById('setupApiUrl').value.trim(),btn=document.querySelector('.setup-btn'),err=document.getElementById('setupError'),suc=document.getElementById('setupSuccess');err.classList.remove('show');suc.classList.remove('show');if(!u||!u.includes('script.google.com')){err.textContent='URL inv√°lida';err.classList.add('show');return}btn.disabled=true;btn.textContent='Conectando...';try{var r=await fetch(u+'?action=getDashboardData');var j=await r.json();if(j.error)throw new Error(j.error);suc.textContent='‚úì Conectado!';suc.classList.add('show');API_URL=u;localStorage.setItem('clinica_api_url',u);setTimeout(function(){document.getElementById('setupScreen').classList.add('hide');iniciarApp()},800)}catch(e){err.textContent='Erro: '+e.message;err.classList.add('show');btn.disabled=false;btn.textContent='Conectar'}}
function iniciarApp(){document.getElementById('setupScreen').classList.add('hide');document.getElementById('splash').classList.remove('hide');document.getElementById('appMain').classList.remove('hide');carregarDados()}
function abrirConfig(){if(confirm('Reconfigurar?')){localStorage.removeItem('clinica_api_url');location.reload()}}
document.addEventListener('DOMContentLoaded',checkConfig);

async function apiPost(a,d){try{return await(await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'action='+a+'&data='+encodeURIComponent(JSON.stringify(d))})).json()}catch(e){return{success:false,message:'Erro'}}}
async function carregarDados(){try{var r=await fetch(API_URL+'?action=getDashboardData');data=await r.json();atualizarTudo()}catch(e){}document.getElementById('splash').classList.add('hide')}
function atualizarTudo(){atualizarResumo();atualizarClientes();atualizarContas();atualizarGatos();atualizarCartoes();atualizarFin()}

function fmtMoeda(v){return'R$ '+(v||0).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2})}
function fmtCurto(v){if(Math.abs(v)>=1000)return'R$'+(v/1000).toFixed(1)+'k';return'R$'+(v||0).toFixed(0)}

function atualizarResumo(){var r=data.resumo||{};document.getElementById('vEntradas').textContent=fmtMoeda(r.totalEntradas);document.getElementById('vSaidas').textContent=fmtMoeda(r.totalSaidas);document.getElementById('vAReceber').textContent=fmtMoeda(r.aReceber);document.getElementById('vAPagar').textContent=fmtMoeda(r.aPagar)}

function atualizarClientes(){var c=document.getElementById('listaClientes'),list=data.clientes||[],pend=list.filter(function(x){return!x.pago});document.getElementById('badgeClientes').textContent=pend.length+'/'+list.length;if(!list.length){c.innerHTML='<div class="empty"><div class="empty-icon">üí™</div><p>Nenhum cliente cadastrado</p></div>';return}var html='';list.sort(function(a,b){return a.dia-b.dia}).forEach(function(cli){var tipoClass=cli.tipo.toLowerCase()==='pilates'?'pilates':'fisio';html+='<div class="item '+(cli.pago?'pago':'')+'"><input type="checkbox" class="item-check" '+(cli.pago?'checked':'')+' onchange="toggleCliente(\''+cli.nome.replace(/'/g,"\\'")+'\',this.checked)"><div class="item-info"><div class="item-nome">'+cli.nome+'<span class="item-tipo '+tipoClass+'">'+cli.tipo+'</span></div><div class="item-detalhe">Dia '+cli.dia+'</div></div><div class="item-valor green">'+fmtMoeda(cli.valor)+'</div><button class="item-del" onclick="excluirCliente(\''+cli.nome.replace(/'/g,"\\'")+'\')">üóëÔ∏è</button></div>'});c.innerHTML=html}

function atualizarContas(){var c=document.getElementById('listaContas'),list=data.contasFixas||[],pend=list.filter(function(x){return!x.pago});document.getElementById('badgeContas').textContent=pend.length+'/'+list.length;if(!list.length){c.innerHTML='<div class="empty"><div class="empty-icon">üìã</div><p>Nenhuma conta cadastrada</p></div>';return}var html='';list.sort(function(a,b){return a.dia-b.dia}).forEach(function(conta){html+='<div class="item '+(conta.pago?'pago':'')+'"><input type="checkbox" class="item-check" '+(conta.pago?'checked':'')+' onchange="toggleConta(\''+conta.nome.replace(/'/g,"\\'")+'\',this.checked)"><div class="item-info"><div class="item-nome">'+conta.nome+'</div><div class="item-detalhe">Dia '+conta.dia+'</div></div><div class="item-valor red">'+fmtMoeda(conta.valor)+'</div><button class="item-del" onclick="excluirConta(\''+conta.nome.replace(/'/g,"\\'")+'\')">üóëÔ∏è</button></div>'});c.innerHTML=html}

function atualizarGatos(){var c=document.getElementById('listaGatos'),list=data.gatos||[],pend=list.filter(function(x){return!x.pago});document.getElementById('badgeGatos').textContent=pend.length+'/'+list.length;if(!list.length){c.innerHTML='<div class="empty"><div class="empty-icon">üê±</div><p>Nenhuma despesa cadastrada</p></div>';return}var html='';list.forEach(function(g){var tipoClass=g.tipo.toLowerCase()==='fixo'?'fixo':'variavel';html+='<div class="item '+(g.pago?'pago':'')+'"><input type="checkbox" class="item-check" '+(g.pago?'checked':'')+' onchange="toggleGato(\''+g.nome.replace(/'/g,"\\'")+'\',this.checked)"><div class="item-info"><div class="item-nome">'+g.nome+'<span class="item-tipo '+tipoClass+'">'+g.tipo+'</span></div></div><div class="item-valor red">'+fmtMoeda(g.valor)+'</div><button class="item-del" onclick="excluirGato(\''+g.nome.replace(/'/g,"\\'")+'\')">üóëÔ∏è</button></div>'});c.innerHTML=html}

function atualizarCartoes(){var c=document.getElementById('listaCartoes'),list=data.cartoes||[];if(!list.length){c.innerHTML='<div class="empty" style="grid-column:span 3"><div class="empty-icon">üí≥</div><p>Nenhum cart√£o</p></div>';return}var html='';list.forEach(function(cart){html+='<div class="cartao-box"><button class="cartao-del" onclick="excluirCartao(\''+cart.nome.replace(/'/g,"\\'")+'\')">√ó</button><div class="cartao-nome">'+cart.nome+'</div><div class="cartao-fat">'+fmtMoeda(0)+'</div><div class="cartao-disp">Lim: '+fmtCurto(cart.limite)+'</div></div>'});c.innerHTML=html}

function atualizarFin(){var c=document.getElementById('listaFin'),list=data.financiamentos||[];if(!list.length){c.innerHTML='<div class="empty"><div class="empty-icon">üè¶</div><p>Nenhum financiamento</p></div>';return}var html='';list.forEach(function(f){var pct=(f.parcelaAtual-1)/f.parcelas*100;html+='<div class="fin-box"><button class="fin-del" onclick="excluirFin(\''+f.nome.replace(/'/g,"\\'")+'\')">√ó</button><div class="fin-nome">'+f.nome+'</div><div class="fin-info"><span class="fin-parcela">'+f.parcelaAtual+'/'+f.parcelas+' ‚Ä¢ Vence dia '+f.diaVencimento+'</span><span class="fin-valor">'+fmtMoeda(f.valorParcela)+'</span></div><div class="fin-progress"><div class="fin-progress-bar" style="width:'+pct+'%"></div></div></div>'});c.innerHTML=html}

function toggleSection(id){document.getElementById(id).classList.toggle('closed')}
function switchTab(id){document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('active')});document.querySelectorAll('.nav-btn').forEach(function(b){b.classList.remove('active')});document.getElementById(id).classList.add('active');event.target.closest('.nav-btn').classList.add('active')}

async function toggleCliente(nome,pago){var r=await apiPost('marcarClientePago',{nome:nome,pago:pago});if(r.success){toast(pago?'‚úì Recebido!':'Desmarcado','ok');carregarDados()}else toast(r.message,'err')}
async function toggleConta(nome,pago){var r=await apiPost('marcarContaFixaPaga',{nome:nome,pago:pago});if(r.success){toast(pago?'‚úì Pago!':'Desmarcado','ok');carregarDados()}else toast(r.message,'err')}
async function toggleGato(nome,pago){var r=await apiPost('marcarGatoPago',{nome:nome,pago:pago});if(r.success){toast(pago?'‚úì Pago!':'Desmarcado','ok');carregarDados()}else toast(r.message,'err')}

async function excluirCliente(nome){if(!confirm('Excluir '+nome+'?'))return;var r=await apiPost('removerCliente',{nome:nome});if(r.success){toast('Exclu√≠do!','ok');carregarDados()}else toast(r.message,'err')}
async function excluirConta(nome){if(!confirm('Excluir '+nome+'?'))return;var r=await apiPost('removerContaFixa',{nome:nome});if(r.success){toast('Exclu√≠do!','ok');carregarDados()}else toast(r.message,'err')}
async function excluirGato(nome){if(!confirm('Excluir '+nome+'?'))return;var r=await apiPost('removerGato',{nome:nome});if(r.success){toast('Exclu√≠do!','ok');carregarDados()}else toast(r.message,'err')}
async function excluirCartao(nome){if(!confirm('Excluir '+nome+'?'))return;var r=await apiPost('removerCartao',{nome:nome});if(r.success){toast('Exclu√≠do!','ok');carregarDados()}else toast(r.message,'err')}
async function excluirFin(nome){if(!confirm('Excluir '+nome+'?'))return;var r=await apiPost('removerFinanciamento',{nome:nome});if(r.success){toast('Exclu√≠do!','ok');carregarDados()}else toast(r.message,'err')}

async function salvarCliente(e){e.preventDefault();var r=await apiPost('adicionarCliente',{nome:document.getElementById('cliNome').value,tipo:document.getElementById('cliTipo').value,dia:parseInt(document.getElementById('cliDia').value),valor:parseFloat(document.getElementById('cliValor').value)});if(r.success){toast('‚úì Cliente adicionado!','ok');e.target.reset();carregarDados()}else toast(r.message,'err')}
async function salvarConta(e){e.preventDefault();var r=await apiPost('adicionarContaFixa',{nome:document.getElementById('contaNome').value,dia:parseInt(document.getElementById('contaDia').value),valor:parseFloat(document.getElementById('contaValor').value)});if(r.success){toast('‚úì Conta adicionada!','ok');e.target.reset();carregarDados()}else toast(r.message,'err')}
async function salvarGato(e){e.preventDefault();var r=await apiPost('adicionarGato',{nome:document.getElementById('gatoNome').value,tipo:document.getElementById('gatoTipo').value,valor:parseFloat(document.getElementById('gatoValor').value)});if(r.success){toast('‚úì Despesa adicionada!','ok');e.target.reset();carregarDados()}else toast(r.message,'err')}
async function salvarCartao(e){e.preventDefault();var r=await apiPost('adicionarCartao',{nome:document.getElementById('cartNome').value,limite:parseFloat(document.getElementById('cartLimite').value),diaFechamento:parseInt(document.getElementById('cartFech').value),diaVencimento:parseInt(document.getElementById('cartVenc').value)});if(r.success){toast('‚úì Cart√£o adicionado!','ok');e.target.reset();carregarDados()}else toast(r.message,'err')}
async function salvarFin(e){e.preventDefault();var r=await apiPost('adicionarFinanciamento',{nome:document.getElementById('finNome').value,valorTotal:parseFloat(document.getElementById('finTotal').value),parcelas:parseInt(document.getElementById('finParcelas').value),parcelaAtual:parseInt(document.getElementById('finAtual').value),valorParcela:parseFloat(document.getElementById('finValor').value),diaVencimento:parseInt(document.getElementById('finDia').value)});if(r.success){toast('‚úì Financiamento adicionado!','ok');e.target.reset();carregarDados()}else toast(r.message,'err')}

async function resetarMes(){if(!confirm('Iniciar novo m√™s?\n\nIsso vai:\n‚Ä¢ Desmarcar todos os pagamentos\n‚Ä¢ Remover despesas vari√°veis dos gatos\n‚Ä¢ Avan√ßar parcela dos financiamentos'))return;var r=await apiPost('resetarMes',{});if(r.success){toast('‚úì Novo m√™s iniciado!','ok');carregarDados()}else toast(r.message,'err')}

function toast(msg,type){var w=document.getElementById('toastWrap'),t=document.createElement('div');t.className='toast '+(type||'');t.textContent=msg;w.appendChild(t);setTimeout(function(){t.remove()},3000)}
</script>
</body>
</html>
